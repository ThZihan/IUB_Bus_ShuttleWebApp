<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Shuttle Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">

    <style>
    </style>
</head>
<body>
<div id="home" class="dashboard-container">
    <!-- Sidebar -->
    <nav id="sidebar" class="active">
        <div class="sidebar-header">
            <i class="fas fa-bus-alt fa-2x"></i>
            <span style="display: none;" id="iconText">IUB Smart Bus Shuttle</span>
        </div>
        <ul class="list-unstyled components">
            <li class="active">
                <a href="#home">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="#scheduleBooking">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Schedule & Booking</span>
                </a>
            </li>
            <li>
                <a href="#feedbackComplaints">
                    <i class="fas fa-comments"></i>
                    <span>Feedback & Complaints</span>
                </a>
            </li>
            <li>
                <a href="profile.html">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
            </li>
            <li>
                <a href="settings.html">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div id="content">
        <!-- Topbar -->
        <nav class="navbar navbar-expand-lg navbar-fixed-top">
            <div class="container-fluid">
                <button type="button" id="sidebarCollapse" class="btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="d-flex align-items-center ms-auto">
                    <!-- Clock -->
                    <div class="account-status me-3"> Account Status: <span class="badge bg-success" id="account_status">Active</span></div>
                    <div class="clock me-3" id="realtime-clock"></div>
                    <!-- Notifications -->
                    <div class="dropdown notifications">
                        <button class="btn position-relative" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">3</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Shuttle arriving in 5 minutes</a></li>
                            <li><a class="dropdown-item" href="#">Booking confirmed</a></li>
                            <li><a class="dropdown-item" href="#">Schedule updated</a></li>
                        </ul>
                    </div>
                    <!-- User Profile -->
                    <div class="dropdown ms-3">
                        <button class="btn d-flex align-items-center" type="button" data-bs-toggle="dropdown">
                            <img id="userPicture" src="" class="rounded-circle me-2" alt="Profile">
                            <span id="userFullName">User</span> <!-- Updated dynamically -->
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a href="profile.html" class="dropdown-item">Profile</a></li>
                            <li><a class="dropdown-item" href="settings.html">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a href="#" id="logoutBtn" class="dropdown-item">Logout</a></li>
                        </ul>
                    </div>

                </div>
            </div>
        </nav>

        <div class="hero-section">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1>Welcome to IUB Smart Shuttle Dashboard</h1>
                <p>Your shuttle schedules and bookings Assistant.</p>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="container-fluid dashboard-content">
            <!-- Quick Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-info">
                            <h6>Today's Rides</h6>
                            <h3>2</h3>
                        </div>
                        <div class="stat-card-icon">
                            <i class="fas fa-bus"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-info">
                            <h6>Your shuttle ETA:</h6>
                            <h3 id="estimatedTime"></h3>
                        </div>
                        <div class="stat-card-icon">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-info">
                            <h6>Next Shuttle Arrival</h6>
                            <h3 id="next-shuttle-time">08:30 AM</h3>
                        </div>
                        <div class="stat-card-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-info">
                            <h6>Your Total Trips</h6>
                            <h3>48</h3>
                        </div>
                        <div class="stat-card-icon">
                            <i class="fas fa-route"></i>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Live Tracking Map -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Live Shuttle Tracking</h5>
                        </div>
                        <div class="card-body">
                            <!-- Search Shuttle Input -->
                            <div class="input-group mb-3">
                                <input type="text" id="shuttle-search-input" class="form-control" placeholder="Enter Shuttle ID">
                                <button id="search-shuttle-btn" class="btn btn-primary" type="button">Search Shuttle</button>
                            </div>
                            <div id="google-map"></div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Upcoming Rides & Notifications -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Your Upcoming Rides</h5>
                        </div>
                        <div class="card-body">
                            <div class="upcoming-ride">
                                <div class="ride-info">
                                    <div class="time">08:30 AM</div>
                                    <div class="route">
                                        <span>Airport Bus Stop</span>
                                        <i class="fas fa-arrow-right"></i>
                                        <span>IUB Campus</span>
                                    </div>
                                </div>
                                <div class="ride-status">
                                    <span class="badge bg-success">Confirmed</span>
                                </div>
                            </div>
                            <div class="upcoming-ride">
                                <div class="ride-info">
                                    <div class="time">05:30 PM</div>
                                    <div class="route">
                                        <span>IUB Campus</span>
                                        <i class="fas fa-arrow-right"></i>
                                        <span>Uttara Housebuilding</span>
                                    </div>
                                </div>
                                <div class="ride-status">
                                    <span class="badge bg-warning">Pending</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Recent Notifications</h5>
                        </div>
                        <div class="card-body">
                            <div class="notification-item">
                                <div class="notification-icon">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <div class="notification-content">
                                    <p>Your shuttle will arrive in 5 minutes</p>
                                    <small>3 minutes ago</small>
                                </div>
                            </div>
                            <div class="notification-item">
                                <div class="notification-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="notification-content">
                                    <p>Booking confirmed for tomorrow</p>
                                    <small>1 hour ago</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schedule & Booking Section -->
                <section id="scheduleBooking" class="py-4">
                    <h2 class="section-title">Schedule & Booking</h2>
                    <!-- Your Upcoming Rides -->
                    <div class="table-responsive mb-4">
                        <h5>Your Upcoming Rides</h5>
                        <table class="table table-striped">
                            <thead class="bg-gradient-primary text-white">
                            <tr>
                                <th>Booking ID</th>
                                <th>Shuttle ID</th>
                                <th>Route</th>
                                <th>Departure Time</th>
                                <th>Arrival Time</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody id="upcomingRidesBody">
                            <!-- Dynamic Booking Rows Will Be Injected Here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="table-responsive mb-4">
                        <h5>Available Schedules</h5>
                        <table class="table table-striped">
                            <thead class="bg-gradient-primary text-white">
                            <tr>
                                <th>Shuttle ID</th>
                                <th>Route</th>
                                <th>Departure Time</th>
                                <th>Arrival Time</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody id="availableSchedulesBody">
                            <!-- Dynamic Available Schedule Rows Will Be Injected Here -->
                            </tbody>
                        </table>
                    </div>
                </section>


                <!-- Booking Modal -->
                <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="bookingForm">
                                <div class="modal-header bg-gradient-primary text-white">
                                    <h5 class="modal-title" id="bookingModalLabel">Book Your Seat</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <!-- Hidden Fields to Store Shuttle Information -->
                                    <input type="hidden" id="modalScheduleId" name="schedule_id">
                                    <input type="hidden" id="modalShuttleId" name="shuttle_id">

                                    <div class="mb-3">
                                        <label for="shuttleId" class="form-label">Shuttle ID</label>
                                        <input type="text" class="form-control" id="shuttleId" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="routeName" class="form-label">Route</label>
                                        <input type="text" class="form-control" id="routeName" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="departureTime" class="form-label">Departure Time</label>
                                        <input type="text" class="form-control" id="departureTime" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="arrivalTime" class="form-label">Arrival Time</label>
                                        <input type="text" class="form-control" id="arrivalTime" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="numberOfPassengers" class="form-label">Number of Passengers</label>
                                        <input type="number" class="form-control" id="numberOfPassengers" name="number_of_passengers" min="1" value="1" required>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Confirm Booking</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>



                <section id="feedbackComplaints" class="py-4">
                    <h2 class="section-title">Feedback & Complaints</h2>
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#feedbackModal">Submit Feedback</button>

                    <!-- Submitted Feedback Table -->
                    <div class="table-responsive">
                        <h5>Your Submitted Feedback</h5>
                        <table class="table table-striped">
                            <thead class="bg-gradient-primary text-white">
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Message</th>
                                <th>Status</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>2024-11-14</td>
                                <td>Complaint</td>
                                <td>Shuttle S002 arrived late.</td>
                                <td><span class="badge bg-warning">Pending</span></td>
                            </tr>
                            <tr>
                                <td>2024-11-10</td>
                                <td>Feedback</td>
                                <td>Excellent service on Shuttle S001!</td>
                                <td><span class="badge bg-success">Resolved</span></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Feedback Modal -->
                <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-gradient-primary text-white">
                                <h5 class="modal-title" id="feedbackModalLabel">Submit Feedback or Complaint</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="mb-3">
                                        <label for="feedbackType" class="form-label">Type</label>
                                        <select id="feedbackType" class="form-select" required>
                                            <option value="">Select...</option>
                                            <option value="Feedback">Feedback</option>
                                            <option value="Complaint">Complaint</option>
                                            <option value="Suggestion">Suggestion</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="feedbackMessage" class="form-label">Message</label>
                                        <textarea id="feedbackMessage" class="form-control" rows="4" placeholder="Write your message..." required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Submit</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>

    // Initialize the map with markers
    let map;
    let markers = [];

    function initMap() {
        const centerMap = { lat: 23.8158287, lng: 90.428023 };
        const mapOptions = {
            center: centerMap,
            zoom: 16,
            disableDefaultUI: true,
        };

        map = new google.maps.Map(document.getElementById('google-map'), mapOptions);

        // Add bus markers to the map
        markers = markersData.map(markerData => {
            return new google.maps.Marker({
                position: { lat: markerData.latitude, lng: markerData.longitude },
                map: map,
                title: `Bus: ${markerData.shuttleID} - Route: ${markerData.routeNo} - Destination: ${markerData.destination}`,
                icon: {
                    url: "https://freesvg.org/img/Bus-Icon.png",
                    scaledSize: new google.maps.Size(35, 32),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(16, 16)
                }
            });
        });
    }

    // Marker data for shuttles
    const markersData = [
        {
            shuttleID: 'S001',
            routeNo: '5',
            latitude: 23.819019,
            longitude: 90.429707,
            destination: 'IUB'
        },
        {
            shuttleID: 'S002',
            routeNo: '1',
            latitude: 23.816817,
            longitude: 90.435492,
            destination: 'Badda'
        },
        {
            shuttleID: 'S003',
            routeNo: '2',
            latitude: 23.814666,
            longitude: 90.421198,
            destination: 'Mirpur'
        },
        {
            shuttleID: 'S004',
            routeNo: '5',
            latitude: 23.8158287,
            longitude: 90.428023,
            destination: 'Mohakhali'
        }
    ];

    // Initialize map
    initMap();

</script>
<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-NqajIvj_EVijypCm-4UVztEhWk135xI&callback=initMap"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function() {
        console.log('Document is ready.');

        // Initialize the dashboard by fetching data
        fetchAvailableSchedules();
        fetchUserBookings();

        // Handle sidebar toggle
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active');
            console.log('Sidebar toggle clicked.');
        });

        // Handle Booking Form Submission
        $('#bookingForm').on('submit', function(e) {
            e.preventDefault();
            console.log('Booking form submitted.');
            submitBookingForm();
        });

        // Handle Feedback Form Submission
        $('#feedbackForm').on('submit', function(e) {
            e.preventDefault();
            console.log('Feedback form submitted.');
            submitFeedbackForm();
        });

        // Handle Logout
        $('#logoutBtn').on('click', function(e) {
            e.preventDefault();
            console.log('Logout button clicked.');
            logoutUser();
        });
    });

    // Function to fetch available shuttle schedules
    function fetchAvailableSchedules() {
        $.ajax({
            url: 'http://localhost:3000/user/shuttle-schedules', // Ensure full URL is used
            method: 'GET',
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
                console.log('Fetched shuttle schedules:', response.shuttleSchedules);
                populateAvailableSchedules(response.shuttleSchedules);
            },
            error: function(xhr) {
                console.error('Error fetching shuttle schedules:', xhr.responseJSON.error);
                alert('Failed to load shuttle schedules.');
            }
        });
    }

    // Function to populate the Available Schedules table
    function populateAvailableSchedules(schedules) {
        const tbody = $('#availableSchedulesBody');
        tbody.empty(); // Clear existing data

        if (schedules.length === 0) {
            tbody.append('<tr><td colspan="7" class="text-center">No available schedules at the moment.</td></tr>');
            return;
        }

        schedules.forEach(schedule => {
            const days = schedule.days_of_operation.split(',').join(', ');
            const availableSeats = schedule.capacity - schedule.booked_seats;
            let statusBadge = '';

            if (availableSeats > 10) {
                statusBadge = '<span class="badge bg-success">Available</span>';
            } else if (availableSeats > 0) {
                statusBadge = '<span class="badge bg-warning">Few Seats</span>';
            } else {
                statusBadge = '<span class="badge bg-danger">Full</span>';
            }

            const row = `
            <tr>
                <td>${schedule.shuttle_id}</td>
                <td>${schedule.route_name} (${schedule.start_location} → ${schedule.end_location})</td>
                <td>${formatTime(schedule.departure_time)}</td>
                <td>${formatTime(schedule.arrival_time)}</td>
                <td>${statusBadge}</td>
                <td>
                    <button class="btn btn-primary btn-sm book-now-btn"
                        data-schedule-id="${schedule.schedule_id}"
                        data-shuttle-id="${schedule.shuttle_id}"
                        data-route-name="${schedule.route_name}"
                        data-departure-time="${schedule.departure_time}"
                        data-arrival-time="${schedule.arrival_time}"
                        data-days="${schedule.days_of_operation}">
                        Book Now
                    </button>
                </td>
            </tr>
        `;
            tbody.append(row);
        });

        // Attach event listeners to the new Book Now buttons
        $('.book-now-btn').on('click', function() {
            const scheduleId = $(this).data('schedule-id');
            const shuttleId = $(this).data('shuttle-id');
            const routeName = $(this).data('route-name');
            const departureTime = $(this).data('departure-time');
            const arrivalTime = $(this).data('arrival-time');
            const days = $(this).data('days').split(',').join(', ');

            console.log(`Book Now clicked for Schedule ID: ${scheduleId}`);

            // Populate the booking modal with schedule details
            $('#modalScheduleId').val(scheduleId);
            $('#modalShuttleId').val(shuttleId);
            $('#shuttleId').val(shuttleId);
            $('#routeName').val(routeName);
            $('#departureTime').val(formatTime(departureTime));
            $('#arrivalTime').val(formatTime(arrivalTime));

            // Show the booking modal
            $('#bookingModal').modal('show');
            console.log('Booking modal displayed.');
        });
    }

    // Function to format time from HH:MM:SS to HH:MM AM/PM
    function formatTime(timeStr) {
        const [hour, minute, second] = timeStr.split(':');
        let period = 'AM';
        let hourInt = parseInt(hour, 10);

        if (hourInt >= 12) {
            period = 'PM';
            if (hourInt > 12) hourInt -= 12;
        }
        if (hourInt === 0) {
            hourInt = 12;
        }

        return `${hourInt}:${minute} ${period}`;
    }

    // Function to fetch user bookings
    function fetchUserBookings() {
        $.ajax({
            url: 'http://localhost:3000/user/bookings', // Ensure full URL is used
            method: 'GET',
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
                console.log('Fetched user bookings:', response.bookings);
                populateUserBookings(response.bookings);
            },
            error: function(xhr) {
                console.error('Error fetching user bookings:', xhr.responseJSON.error);
                alert('Failed to load your bookings.');
            }
        });
    }

    // Function to populate the User's Bookings table
    function populateUserBookings(bookings) {
        const tbody = $('#upcomingRidesBody');
        tbody.empty(); // Clear existing data

        if (bookings.length === 0) {
            tbody.append('<tr><td colspan="7" class="text-center">No upcoming rides.</td></tr>');
            return;
        }

        bookings.forEach(booking => {
            const statusBadge = getBookingStatusBadge(booking.booking_status);
            const row = `
            <tr>
                <td>${booking.booking_id}</td>
                <td>${booking.shuttle_id}</td>
                <td>${booking.route_name} (${booking.start_location} → ${booking.end_location})</td>
                <td>${formatTime(booking.departure_time)}</td>
                <td>${formatTime(booking.arrival_time)}</td>
                <td>${statusBadge}</td>
                <td>
                    ${booking.booking_status !== 'Cancelled' ?
                `<button class="btn btn-danger btn-sm cancel-booking-btn" data-booking-id="${booking.booking_id}">Cancel</button>`
                : 'N/A'}
                </td>
            </tr>
        `;
            tbody.append(row);
        });

        // Attach event listeners to the new Cancel buttons
        $('.cancel-booking-btn').on('click', function() {
            const bookingId = $(this).data('booking-id');
            console.log(`Cancel button clicked for Booking ID: ${bookingId}`);
            cancelBooking(bookingId);
        });
    }

    // Function to get booking status badge
    function getBookingStatusBadge(status) {
        let badgeClass = 'bg-secondary';
        switch(status) {
            case 'Pending':
                badgeClass = 'bg-warning';
                break;
            case 'Approved':
                badgeClass = 'bg-success';
                break;
            case 'Rejected':
                badgeClass = 'bg-danger';
                break;
            case 'Cancelled':
                badgeClass = 'bg-dark';
                break;
        }
        return `<span class="badge ${badgeClass}">${status}</span>`;
    }

    // Function to handle booking form submission
    function submitBookingForm() {
        const scheduleId = $('#modalScheduleId').val();
        const numberOfPassengers = parseInt($('#numberOfPassengers').val(), 10);

        // Validate number of passengers
        if (isNaN(numberOfPassengers) || numberOfPassengers <= 0) {
            alert('Please enter a valid number of passengers.');
            return;
        }

        // Prepare the data
        const bookingData = {
            schedule_id: scheduleId,
            number_of_passengers: numberOfPassengers
        };

        console.log('Booking Data:', bookingData);

        // Send the booking request
        $.ajax({
            url: 'http://localhost:3000/user/bookings', // Ensure full URL is used
            method: 'POST',
            contentType: 'application/json',
            xhrFields: {
                withCredentials: true
            },
            data: JSON.stringify(bookingData),
            success: function(response) {
                console.log('Booking success:', response);
                alert(response.message);
                $('#bookingModal').modal('hide');
                // Refresh the bookings and available schedules
                fetchUserBookings();
                fetchAvailableSchedules();
            },
            error: function(xhr) {
                console.error('Error creating booking:', xhr.responseJSON.error);
                alert(`Failed to create booking: ${xhr.responseJSON.error}`);
            }
        });
    }

    // Function to handle booking cancellation
    function cancelBooking(bookingId) {
        if (!confirm('Are you sure you want to cancel this booking?')) {
            return;
        }

        console.log(`Cancelling Booking ID: ${bookingId}`);

        $.ajax({
            url: `http://localhost:3000/user/bookings/${bookingId}`, // Ensure full URL is used
            method: 'DELETE',
            xhrFields: {
                withCredentials: true
            },
            success: function(response) {
                console.log('Booking cancellation success:', response);
                alert(response.message);
                // Refresh the bookings and available schedules
                fetchUserBookings();
                fetchAvailableSchedules();
            },
            error: function(xhr) {
                console.error('Error cancelling booking:', xhr.responseJSON.error);
                alert(`Failed to cancel booking: ${xhr.responseJSON.error}`);
            }
        });
    }

    // Function to handle feedback form submission
    function submitFeedbackForm() {
        const feedbackType = $('#feedbackType').val();
        const feedbackMessage = $('#feedbackMessage').val().trim();

        if (!feedbackType || !feedbackMessage) {
            alert('Please fill in all required fields.');
            return;
        }

        const feedbackData = {
            type: feedbackType,
            message: feedbackMessage
        };

        console.log('Feedback Data:', feedbackData);

        $.ajax({
            url: 'http://localhost:3000/user/feedback', // Ensure this endpoint exists on the backend
            method: 'POST',
            contentType: 'application/json',
            xhrFields: {
                withCredentials: true
            },
            data: JSON.stringify(feedbackData),
            success: function(response) {
                console.log('Feedback submission success:', response);
                alert('Feedback submitted successfully!');
                $('#feedbackModal').modal('hide');
                // Optionally, refresh the feedback table
            },
            error: function(xhr) {
                console.error('Error submitting feedback:', xhr.responseJSON.error);
                alert(`Failed to submit feedback: ${xhr.responseJSON.error}`);
            }
        });
    }
</script>
<script src="js/dashboard.js"></script>

<!-- New Script for Session Management -->

</body>
</html>
